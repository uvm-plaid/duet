-- Presna algorithm
let main = pÎ» Îµ : â„âº,
              Î´ : â„âº
              .
              -- interval:â„•,phone_id:â„•,x:â„•,y:â„•,hash:ğ•Š
              incoming : ğ•„ [Lâˆ , U | â˜… , ğ â„• âˆ· ğ â„• âˆ· ğ â„• âˆ· ğ â„• âˆ· ğ ğ•Š âˆ· [] ],
              outgoing : ğ•„ [Lâˆ , U | â˜… , ğ â„• âˆ· ğ â„• âˆ· ğ â„• âˆ· ğ â„• âˆ· ğ ğ•Š âˆ· [] ],
              blocks   : â„˜ (ğ â„• Ã— ğ â„•),      -- set of all the blocks of interest
              crisis   : â„˜ (ğ â„• Ã— ğ â„•),      -- set of blocks in crisis
              Îµ : â„âº[Îµ],
              Î´ : â„âº[Î´],
              r : â„•[0],
              s : â„•[2],
              t : â„•[3],
              u : â„•[4],
              v : â„•[4]
              â‡’

  let getXY = sÎ» row : ğ•„ [Lâˆ , U | 1 , ğ â„• âˆ· ğ â„• âˆ· ğ â„• âˆ· ğ â„• âˆ· ğ ğ•Š âˆ· ğ â„• âˆ· ğ â„• âˆ· ğ â„• âˆ· ğ â„• âˆ· ğ ğ•Š âˆ· [] ] â‡’
    âŸ¨ row#[r,s], row#[r,t] âŸ©
  in
  -- CRISIS mode
  -- result of the join is a â„• âˆ· â„• âˆ· â„• âˆ· â„• âˆ· ğ•Š âˆ· â„• âˆ· â„• âˆ· â„• âˆ· â„• âˆ· ğ•Š âˆ· []
  --                        |    INCOMING      |      OUTGOING     |
  --           eventually we want a list of variables here, do not worry about this for now
  --           âŒ„
  -- parallel <> [ joinâ‚[outgoing, embed x + embed y, incoming, 4] , â„˜ { true, false } ] { row â‡’ (getXY row) âˆˆ crisis }
  parallel [ joinâ‚[outgoing, u, incoming, v] , â„˜ { true, false } ] { row â‡’ (getXY row) âˆˆ crisis }
      { n, pb â‡’
          r â† parallel [pb, blocks] { row â‡’ getXY row }
                { b, p â‡’ noisyCount â† gauss[â„âº[1.0], Îµ, Î´] <p> { real (rows p) };
                         return âŸ¨b, noisyCountâŸ© };
          return âŸ¨n, râŸ©
      }
in main
